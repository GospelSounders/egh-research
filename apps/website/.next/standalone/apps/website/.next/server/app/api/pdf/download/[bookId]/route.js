"use strict";(()=>{var e={};e.id=626,e.ids=[626],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},2440:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>h,patchFetch:()=>m,requestAsyncStorage:()=>u,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var r={};o.r(r),o.d(r,{GET:()=>l,dynamic:()=>p});var n=o(3985),a=o(8659),s=o(2432),i=o(2937),d=o(1282);let p="force-dynamic";async function l(e,{params:t}){try{let e=parseInt(t.bookId);console.log(`Generating PDF for book ${e}...`);let o=await new Promise((t,o)=>{let r=(0,d.spawn)("node",["/home/brian/Code/MCPSERVERS/egw-writings-mcp/scripts/get-book-content.js",e.toString()]),n="",a="";r.stdout.on("data",e=>{n+=e.toString()}),r.stderr.on("data",e=>{a+=e.toString()}),r.on("close",e=>{if(0===e)try{let e=JSON.parse(n);t(e)}catch(e){o(Error("Failed to parse database response"))}else o(Error(a||"Database query failed"))})});if(!o.success)return i.NextResponse.json({success:!1,error:o.error||"Book not found"},{status:404});let r=o.data,n=`${r.title}
by ${r.author}

`;for(let e of r.chapters){for(let t of(n+=`${e.title}

`,e.paragraphs)){let e=t.content_plain||t.content.replace(/<[^>]*>/g,"");n+=`${e}

`}n+="\n---\n\n"}let a=`${r.title.replace(/[^a-zA-Z0-9]/g,"_")}.txt`;return new i.NextResponse(n,{status:200,headers:{"Content-Type":"text/plain","Content-Disposition":`attachment; filename="${a}"`,"Content-Length":n.length.toString()}})}catch(e){return console.error("PDF download error:",e),i.NextResponse.json({success:!1,error:e instanceof Error?e.message:"PDF download failed"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/pdf/download/[bookId]/route",pathname:"/api/pdf/download/[bookId]",filename:"route",bundlePath:"app/api/pdf/download/[bookId]/route"},resolvedPagePath:"/home/brian/Code/MCPSERVERS/egw-writings-mcp/apps/website/src/app/api/pdf/download/[bookId]/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:u,staticGenerationAsyncStorage:g,serverHooks:f}=c,h="/api/pdf/download/[bookId]/route";function m(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[800,144],()=>o(2440));module.exports=r})();