"use strict";(()=>{var e={};e.id=740,e.ids=[740],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5315:e=>{e.exports=require("path")},9066:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>j,requestAsyncStorage:()=>R,routeModule:()=>w,serverHooks:()=>S,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>d,POST:()=>g});var o=r(3985),a=r(8659),i=r(2432),n=r(2937);let p=require("fs/promises");var u=r(5315),c=r.n(u);let m=new Map;async function g(e){try{var t;let r=await e.json();if(!r.topic||0===r.topic.trim().length)return n.NextResponse.json({success:!1,jobId:"",message:"Topic is required"},{status:400});let s=`job_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return m.set(s,{status:"queued",topic:r.topic,startTime:new Date,progress:0,message:"Research compilation queued"}),l(s,r),n.NextResponse.json({success:!0,jobId:s,message:"Research compilation started",estimatedDuration:(t=r.maxResults||50,Math.round(60+.5*t))})}catch(e){return console.error("Compilation API error:",e),n.NextResponse.json({success:!1,jobId:"",message:"Internal server error",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function d(e){let{searchParams:t}=new URL(e.url),r=t.get("jobId");if(!r)return n.NextResponse.json({error:"jobId parameter is required"},{status:400});let s=m.get(r);return s?n.NextResponse.json({jobId:r,status:s.status,topic:s.topic,progress:s.progress,message:s.message,startTime:s.startTime,duration:Date.now()-s.startTime.getTime()}):n.NextResponse.json({error:"Job not found"},{status:404})}async function l(e,t){let r=m.get(e);if(r)try{r.status="running",r.progress=10,r.message="Starting Claude Code sandbox...",await f(e,t),r.progress=20,r.message="Searching EGW database...",await h(e,t)}catch(r){console.error(`Compilation failed for job ${e}:`,r);let t=m.get(e);t&&(t.status="failed",t.message=`Compilation failed: ${r instanceof Error?r.message:"Unknown error"}`)}}async function f(e,t){let r={name:`egw-research-${e}`,description:`Automated research compilation for: ${t.topic}`,environment:{RESEARCH_TOPIC:t.topic,MAX_RESULTS:t.maxResults?.toString()||"50",GROUP_BY:t.groupBy||"book",CITATION_STYLE:t.citationStyle||"academic",OUTPUT_FORMAT:t.outputFormat||"pdf",JOB_ID:e},initialPrompt:`
Conduct automated research compilation on: "${t.topic}"

Parameters:
- Max Results: ${t.maxResults||50}
- Organization: ${t.groupBy||"book"}
- Citation Style: ${t.citationStyle||"academic"}
- Output Format: ${t.outputFormat||"pdf"}

Steps:
1. Search EGW database for relevant passages
2. Organize findings according to specified grouping
3. Generate formatted document with proper citations
4. Save output to /workspace/output/${t.topic.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")}.${t.outputFormat||"pdf"}
5. Commit results to repository

Begin compilation now.
    `.trim()},s=c().join(process.cwd(),"temp",`config-${e}.json`);return await (0,p.mkdir)(c().dirname(s),{recursive:!0}),await (0,p.writeFile)(s,JSON.stringify(r,null,2)),s}async function h(e,t){if(m.get(e))for(let t of[{progress:30,message:"Processing search results...",duration:2e3},{progress:50,message:"Organizing content by topic...",duration:3e3},{progress:70,message:"Formatting document...",duration:2e3},{progress:90,message:"Generating PDF...",duration:2e3},{progress:100,message:"Compilation complete!",duration:1e3}]){await new Promise(e=>setTimeout(e,t.duration));let r=m.get(e);r&&(r.progress=t.progress,r.message=t.message,100===t.progress&&(r.status="completed"))}}let w=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/research/compile/route",pathname:"/api/research/compile",filename:"route",bundlePath:"app/api/research/compile/route"},resolvedPagePath:"/home/brian/Code/MCPSERVERS/egw-writings-mcp/apps/website/src/app/api/research/compile/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:R,staticGenerationAsyncStorage:x,serverHooks:S}=w,b="/api/research/compile/route";function j(){return(0,i.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:x})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[800,144],()=>r(9066));module.exports=s})();