(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{4928:function(e,t,a){Promise.resolve().then(a.bind(a,4593))},4593:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var r=a(8980),n=a(2208),o=a(9211),s=a(9603),l=a(3640),c=a(6870),i=a(5999),d=a(3367),u=a(8967),h=a(5662),p=a(9014);function m(){let e=(0,o.useParams)();(0,o.useRouter)();let t=parseInt(e.bookId),[a,m]=(0,n.useState)(null),[g,f]=(0,n.useState)([]),[x,b]=(0,n.useState)(1),[v,w]=(0,n.useState)(!0),[y,k]=(0,n.useState)(null),[j,N]=(0,n.useState)(16),[E,_]=(0,n.useState)(""),[C,I]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&P()},[t]);let P=async()=>{try{let e=await h.u.getBook(t);if(e.success&&e.data){m(e.data);try{let a=await fetch("/api/books/".concat(t,"/content-db")),r=await a.json();if(r.success&&r.data&&r.data.chapters){let e=r.data.chapters.map(e=>({chapter:e.chapter,title:e.title,content:e.paragraphs.map(e=>'<div class="paragraph" data-para-id="'.concat(e.para_id,'">\n                  ').concat(e.content,"\n                </div>")).join("\n")}));f(e)}else A(e.data)}catch(t){console.warn("Could not load database content, using sample:",t),A(e.data)}}else k(e.error||"Book not found")}catch(e){k("Failed to load book content")}finally{w(!1)}},A=e=>{let t=Math.min(Math.max(Math.floor(e.npages/20),5),30),a=[];for(let r=1;r<=t;r++)a.push({chapter:r,title:"Chapter ".concat(r),content:"\n          <h2>Chapter ".concat(r,"</h2>\n          <p>This is the content for Chapter ").concat(r,' of "').concat(e.title,'" by ').concat(e.author,'.</p>\n          \n          <p>In a real implementation, this content would be fetched from the EGW API or database. \n          The text would include the actual paragraphs, with proper formatting and references.</p>\n          \n          <p>The book "').concat(e.title,'" was published in ').concat(e.pub_year," and contains ").concat(e.npages," pages \n          of valuable content. Each chapter would contain multiple paragraphs with unique paragraph IDs \n          for citation purposes.</p>\n          \n          <h3>Section ").concat(r,".1</h3>\n          <p>This section would contain the actual content of the book, with proper paragraph \n          structure and reference codes. The content would be formatted with appropriate \n          typography and spacing for optimal reading.</p>\n          \n          <h3>Section ").concat(r,".2</h3>\n          <p>Additional content would appear here, maintaining the original structure and \n          formatting of the published work. Cross-references and footnotes would be preserved \n          and properly linked.</p>\n          \n          <p>To implement the full reading experience, the system would need to:</p>\n          <ul>\n            <li>Fetch actual content from the EGW API</li>\n            <li>Parse and format the text content</li>\n            <li>Implement paragraph-level linking</li>\n            <li>Add cross-reference functionality</li>\n            <li>Include search and navigation features</li>\n          </ul>\n        ")});f(a)},L=e=>{"prev"===e&&x>1?b(x-1):"next"===e&&x<g.length&&b(x+1)};if(v)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(s.Z,{className:"h-8 w-8 text-primary-600 animate-pulse mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading book content..."})]})});if(y||!a)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(l.Z,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Book Not Found"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:y||"The requested book could not be found."}),(0,r.jsxs)(p.default,{href:"/books",className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),"Back to Books"]})]})});let B=g.find(e=>e.chapter===x)||g[0];return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("div",{className:"bg-white border-b sticky top-0 z-10",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)(p.default,{href:"/books",className:"text-gray-500 hover:text-gray-700",children:(0,r.jsx)(c.Z,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-lg font-bold text-gray-900",children:a.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:a.author})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("button",{onClick:()=>I(!C),className:"p-2 text-gray-500 hover:text-gray-700 rounded-md",children:(0,r.jsx)(i.Z,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>N(Math.max(12,j-2)),className:"px-2 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-50",children:"A-"}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:[j,"px"]}),(0,r.jsx)("button",{onClick:()=>N(Math.min(24,j+2)),className:"px-2 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-50",children:"A+"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>L("prev"),disabled:1===x,className:"p-2 text-gray-500 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)(d.Z,{className:"h-5 w-5"})}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:[x," / ",g.length]}),(0,r.jsx)("button",{onClick:()=>L("next"),disabled:x===g.length,className:"p-2 text-gray-500 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)(u.Z,{className:"h-5 w-5"})})]})]})]}),C&&(0,r.jsx)("div",{className:"mt-4 max-w-md",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(i.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{type:"text",placeholder:"Search in this book...",value:E,onChange:e=>_(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500"})]})})]})}),(0,r.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,r.jsx)("div",{className:"border-b p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:(null==B?void 0:B.title)||"Chapter"}),(0,r.jsx)("select",{value:x,onChange:e=>b(parseInt(e.target.value)),className:"border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",children:g.map(e=>(0,r.jsxs)("option",{value:e.chapter,children:["Chapter ",e.chapter]},e.chapter))})]})}),(0,r.jsx)("div",{className:"p-8",children:(0,r.jsx)("div",{className:"prose prose-lg max-w-none",style:{fontSize:"".concat(j,"px"),lineHeight:"1.7"},dangerouslySetInnerHTML:{__html:(null==B?void 0:B.content)||"<p>Loading chapter content...</p>"}})}),(0,r.jsx)("div",{className:"border-t p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("button",{onClick:()=>L("prev"),disabled:1===x,className:"flex items-center px-4 py-2 text-gray-600 hover:text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Previous Chapter"]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["Chapter ",x," of ",g.length]}),(0,r.jsxs)("button",{onClick:()=>L("next"),disabled:x===g.length,className:"flex items-center px-4 py-2 text-gray-600 hover:text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed",children:["Next Chapter",(0,r.jsx)(u.Z,{className:"h-4 w-4 ml-2"})]})]})})]})})]})}},5662:function(e,t,a){"use strict";a.d(t,{u:function(){return n}});class r{async getBooks(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t;let a=new URLSearchParams;if(e.lang&&a.append("language",e.lang),e.limit&&a.append("limit",e.limit.toString()),e.offset){let t=Math.floor(e.offset/(e.limit||20))+1;a.append("page",t.toString())}e.search&&a.append("search",e.search),e.category&&a.append("category",e.category),console.log("Fetching books from local API route...");let r="".concat(this.baseURL,"/books").concat(a.toString()?"?"+a.toString():"");console.log("Full API URL:",r);let n=await fetch(r);if(console.log("Books API response status:",n.status),!n.ok){let e=await n.text();throw console.warn("Books API request failed: ".concat(n.status," - ").concat(e)),Error("Books API request failed: ".concat(n.status))}let o=await n.json();if(console.log("API response received:",o.success,"Books:",null===(t=o.data)||void 0===t?void 0:t.length),!o.success)throw Error(o.error||"API returned unsuccessful response");let s=o.data.map(e=>{var t;return{book_id:e.book_id,title:e.title,author:e.author||"Ellen G. White",pub_year:parseInt(e.pub_year)||0,npages:e.npages||0,lang:e.lang||"en",description:e.description,cover_url:null===(t=e.cover)||void 0===t?void 0:t.small,category:this.categorizeBook(e),publisher:e.publisher,pub_code:e.code}});return{success:!0,data:s,total:s.length,page:1,limit:s.length}}catch(e){return console.error("Failed to fetch books from API:",e),{success:!1,error:e instanceof Error?e.message:"Failed to load books from API"}}}async getBook(e){try{var t;console.log("Fetching book ".concat(e," from local API route..."));let a=await fetch("".concat(this.baseURL,"/books/").concat(e));if(console.log("Book API response for ".concat(e,":"),a.status),!a.ok){let e=await a.text();throw console.warn("Book API request failed: ".concat(a.status," - ").concat(e)),Error("API request failed: ".concat(a.status))}let r=await a.json();if(console.log("Book API response for ".concat(e,":"),r.success),!r.success)throw Error(r.error||"API returned unsuccessful response");let n={book_id:r.data.book_id,title:r.data.title,author:r.data.author||"Ellen G. White",pub_year:parseInt(r.data.pub_year)||0,npages:r.data.npages||0,lang:r.data.lang||"en",description:r.data.description,cover_url:null===(t=r.data.cover)||void 0===t?void 0:t.small,category:this.categorizeBook(r.data),publisher:r.data.publisher,pub_code:r.data.code};return{success:!0,data:n}}catch(t){return console.error("Failed to fetch book ".concat(e," from API:"),t),{success:!1,error:t instanceof Error?t.message:"Failed to load book ".concat(e," from API")}}}async searchBooks(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var a;let r=new URLSearchParams;r.append("q",e),t.limit&&r.append("limit",t.limit.toString()),t.offset&&r.append("offset",t.offset.toString()),t.lang&&r.append("lang",t.lang),t.books&&r.append("books",t.books.join(","));let n=await fetch("".concat(this.baseURL,"/api/search?").concat(r));if(!n.ok)throw Error("API request failed: ".concat(n.status));let o=await n.json(),s=(null===(a=o.results)||void 0===a?void 0:a.map(e=>({para_id:e.para_id,book_id:e.book_id,book_title:e.book_title,chapter:e.chapter||0,page:e.page||0,content:e.content,refcode_short:e.refcode_short,refcode_long:e.refcode_long,relevance:e.relevance})))||[];return{success:!0,data:s,total:o.total,page:o.page,limit:o.limit}}catch(e){return console.error("Failed to search books:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async getBookContent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=new URLSearchParams;t.limit&&a.append("limit",t.limit.toString()),t.offset&&a.append("offset",t.offset.toString()),t.chapter&&a.append("chapter",t.chapter.toString());let r=await fetch("".concat(this.baseURL,"/api/books/").concat(e,"/content?").concat(a));if(!r.ok)throw Error("API request failed: ".concat(r.status));let n=await r.json();return{success:!0,data:n.content||[],total:n.total,page:n.page,limit:n.limit}}catch(e){return console.error("Failed to fetch book content:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}categorizeBook(e){var t,a;let r=(null===(t=e.author)||void 0===t?void 0:t.toLowerCase())||"",n=(null===(a=e.title)||void 0===a?void 0:a.toLowerCase())||"";return r.includes("white")||r.includes("elena")?n.includes("maranatha")||n.includes("heavenly")||n.includes("sons")||n.includes("daughters")?"devotional":"egw":["uriah smith","a. t. jones","j. n. andrews","john andrews","m. l. andreasen","j. n. loughborough"].some(e=>r.includes(e))?"pioneer":n.includes("review")||n.includes("herald")||n.includes("signs")||n.includes("times")||n.includes("youth")||n.includes("instructor")?"periodical":n.includes("history")||n.includes("origin")||n.includes("movement")||n.includes("advent")?"historical":"devotional"}async testConnection(){try{return(await fetch("".concat(this.baseURL,"/api/health"))).ok}catch(e){return!1}}constructor(e="/api/egw"){this.baseURL=e}}let n=new r},9014:function(e,t,a){"use strict";a.d(t,{default:function(){return n.a}});var r=a(3795),n=a.n(r)},9211:function(e,t,a){"use strict";var r=a(2544);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},6870:function(e,t,a){"use strict";var r=a(2208);let n=r.forwardRef(function(e,t){let{title:a,titleId:n,...o}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},o),a?r.createElement("title",{id:n},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))});t.Z=n},9603:function(e,t,a){"use strict";var r=a(2208);let n=r.forwardRef(function(e,t){let{title:a,titleId:n,...o}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},o),a?r.createElement("title",{id:n},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"}))});t.Z=n},3367:function(e,t,a){"use strict";var r=a(2208);let n=r.forwardRef(function(e,t){let{title:a,titleId:n,...o}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},o),a?r.createElement("title",{id:n},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))});t.Z=n},8967:function(e,t,a){"use strict";var r=a(2208);let n=r.forwardRef(function(e,t){let{title:a,titleId:n,...o}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},o),a?r.createElement("title",{id:n},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))});t.Z=n},3640:function(e,t,a){"use strict";var r=a(2208);let n=r.forwardRef(function(e,t){let{title:a,titleId:n,...o}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},o),a?r.createElement("title",{id:n},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))});t.Z=n},5999:function(e,t,a){"use strict";var r=a(2208);let n=r.forwardRef(function(e,t){let{title:a,titleId:n,...o}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},o),a?r.createElement("title",{id:n},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))});t.Z=n}},function(e){e.O(0,[795,14,512,744],function(){return e(e.s=4928)}),_N_E=e.O()}]);